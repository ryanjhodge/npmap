!function(a){var b;if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)b=require("leaflet"),module.exports=a(b);else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){"use strict";return a.Polyline._flat=a.Polyline._flat||function(b){return!a.Util.isArray(b[0])||"object"!=typeof b[0][0]&&"undefined"!=typeof b[0][0]},a.GeometryUtil=a.extend(a.GeometryUtil||{},{distance:function(a,b,c){return a.latLngToLayerPoint(b).distanceTo(a.latLngToLayerPoint(c))},distanceSegment:function(b,c,d,e){var f=b.latLngToLayerPoint(c),g=b.latLngToLayerPoint(d),h=b.latLngToLayerPoint(e);return a.LineUtil.pointToSegmentDistance(f,g,h)},readableDistance:function(a,b){var c,d="imperial"!==b;return d?c=a>1e3?(a/1e3).toFixed(2)+" km":Math.ceil(a)+" m":(a*=1.09361,c=a>1760?(a/1760).toFixed(2)+" miles":Math.ceil(a)+" yd"),c},belongsSegment:function(a,b,c,d){d=void 0===d?.2:d;var e=b.distanceTo(c),f=b.distanceTo(a)+a.distanceTo(c)-e;return f/e<d},length:function(b){var c=a.GeometryUtil.accumulatedLengths(b);return c.length>0?c[c.length-1]:0},accumulatedLengths:function(a){if("function"==typeof a.getLatLngs&&(a=a.getLatLngs()),0===a.length)return[];for(var b=0,c=[0],d=0,e=a.length-1;d<e;d++)b+=a[d].distanceTo(a[d+1]),c.push(b);return c},closestOnSegment:function(b,c,d,e){var f=b.getMaxZoom();f===1/0&&(f=b.getZoom());var g=b.project(c,f),h=b.project(d,f),i=b.project(e,f),j=a.LineUtil.closestPointOnSegment(g,h,i);return b.unproject(j,f)},closest:function(b,c,d,e){var f,g,h,i,j=1/0,k=null;if(c instanceof Array){if(c[0]instanceof Array&&"number"!=typeof c[0][0]){for(var g=0;g<c.length;g++){var l=a.GeometryUtil.closest(b,c[g],d,e);l.distance<j&&(j=l.distance,k=l)}return k}if(!(c[0]instanceof a.LatLng||"number"==typeof c[0][0]))return k;c=a.polyline(c)}if(!(c instanceof a.Polyline))return k;if(f=c.getLatLngs().slice(0),c instanceof a.Polygon){var m=function(b){if(a.Polyline._flat(b))b.push(b[0]);else for(var c=0;c<b.length;c++)m(b[c])};m(f)}if(a.Polyline._flat(f)){if(e){for(g=0,h=f.length;g<h;g++){var n=f[g];i=a.GeometryUtil.distance(b,d,n),i<j&&(j=i,k=n,k.distance=i)}return k}for(g=0,h=f.length;g<h-1;g++){var o=f[g],p=f[g+1];i=a.GeometryUtil.distanceSegment(b,d,o,p),i<=j&&(j=i,k=a.GeometryUtil.closestOnSegment(b,d,o,p),k.distance=i)}return k}for(var g=0;g<f.length;g++){var l=a.GeometryUtil.closest(b,f[g],d,e);l.distance<j&&(j=l.distance,k=l)}return k},closestLayer:function(b,c,d){for(var e=1/0,f=null,g=null,h=1/0,i=0,j=c.length;i<j;i++){var k=c[i];if(k instanceof a.LayerGroup){var l=a.GeometryUtil.closestLayer(b,k.getLayers(),d);l.distance<e&&(e=l.distance,f=l)}else"function"==typeof k.getLatLng?(g=k.getLatLng(),h=a.GeometryUtil.distance(b,d,g)):(g=a.GeometryUtil.closest(b,k,d),g&&(h=g.distance)),h<e&&(e=h,f={layer:k,latlng:g,distance:h})}return f},layersWithin:function(b,c,d,e){e="number"==typeof e?e:1/0;for(var f=[],g=null,h=0,i=0,j=c.length;i<j;i++){var k=c[i];"function"==typeof k.getLatLng?(g=k.getLatLng(),h=a.GeometryUtil.distance(b,d,g)):(g=a.GeometryUtil.closest(b,k,d),g&&(h=g.distance)),g&&h<e&&f.push({layer:k,latlng:g,distance:h})}var l=f.sort(function(a,b){return a.distance-b.distance});return l},closestLayerSnap:function(b,c,d,e,f){e="number"==typeof e?e:1/0,f="boolean"!=typeof f||f;var g=a.GeometryUtil.closestLayer(b,c,d);if(!g||g.distance>e)return null;if(f&&"function"==typeof g.layer.getLatLngs){var h=a.GeometryUtil.closest(b,g.layer,g.latlng,!0);h.distance<e&&(g.latlng=h,g.distance=a.GeometryUtil.distance(b,h,d))}return g},interpolateOnPointSegment:function(b,c,d){return a.point(b.x*(1-d)+d*c.x,b.y*(1-d)+d*c.y)},interpolateOnLine:function(b,c,d){c=c instanceof a.Polyline?c.getLatLngs():c;var e=c.length;if(e<2)return null;if(d=Math.max(Math.min(d,1),0),0===d)return{latLng:c[0]instanceof a.LatLng?c[0]:a.latLng(c[0]),predecessor:-1};if(1==d)return{latLng:c[c.length-1]instanceof a.LatLng?c[c.length-1]:a.latLng(c[c.length-1]),predecessor:c.length-2};var f=b.getMaxZoom();f===1/0&&(f=b.getZoom());for(var g=[],h=0,i=0;i<e;i++)g[i]=b.project(c[i],f),i>0&&(h+=g[i-1].distanceTo(g[i]));for(var j=h*d,k=g[0],l=g[1],m=0,n=k.distanceTo(l),o=1;o<e&&n<j;o++)k=l,m=n,l=g[o],n+=k.distanceTo(l);var p=n-m!==0?(j-m)/(n-m):0,q=a.GeometryUtil.interpolateOnPointSegment(k,l,p);return{latLng:b.unproject(q,f),predecessor:o-2}},locateOnLine:function(b,c,d){var e=c.getLatLngs();if(d.equals(e[0]))return 0;if(d.equals(e[e.length-1]))return 1;for(var f=a.GeometryUtil.closest(b,c,d,!1),g=a.GeometryUtil.accumulatedLengths(e),h=g[g.length-1],i=0,j=!1,k=0,l=e.length-1;k<l;k++){var m=e[k],n=e[k+1];if(i=g[k],a.GeometryUtil.belongsSegment(f,m,n)){i+=m.distanceTo(f),j=!0;break}}if(!j)throw"Could not interpolate "+d.toString()+" within "+c.toString();return i/h},reverse:function(b){return a.polyline(b.getLatLngs().slice(0).reverse())},extract:function(b,c,d,e){if(d>e)return a.GeometryUtil.extract(b,a.GeometryUtil.reverse(c),1-d,1-e);d=Math.max(Math.min(d,1),0),e=Math.max(Math.min(e,1),0);var f=c.getLatLngs(),g=a.GeometryUtil.interpolateOnLine(b,c,d),h=a.GeometryUtil.interpolateOnLine(b,c,e);if(d==e){var i=a.GeometryUtil.interpolateOnLine(b,c,e);return[i.latLng]}g.predecessor==-1&&(g.predecessor=0),h.predecessor==-1&&(h.predecessor=0);var j=f.slice(g.predecessor+1,h.predecessor+1);return j.unshift(g.latLng),j.push(h.latLng),j},isBefore:function(a,b){if(!b)return!1;var c=a.getLatLngs(),d=b.getLatLngs();return c[c.length-1].equals(d[0])},isAfter:function(a,b){if(!b)return!1;var c=a.getLatLngs(),d=b.getLatLngs();return c[0].equals(d[d.length-1])},startsAtExtremity:function(a,b){if(!b)return!1;var c=a.getLatLngs(),d=b.getLatLngs(),e=c[0];return e.equals(d[0])||e.equals(d[d.length-1])},computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},computeSlope:function(a,b){var c=(b.y-a.y)/(b.x-a.x),d=a.y-c*a.x;return{a:c,b:d}},rotatePoint:function(b,c,d,e){var f=b.getMaxZoom();f===1/0&&(f=b.getZoom());var g=d*Math.PI/180,h=b.project(c,f),i=b.project(e,f),j=Math.cos(g)*(h.x-i.x)-Math.sin(g)*(h.y-i.y)+i.x,k=Math.sin(g)*(h.x-i.x)+Math.cos(g)*(h.y-i.y)+i.y;return b.unproject(new a.Point(j,k),f)},bearing:function(a,b){var c=Math.PI/180,d=a.lat*c,e=b.lat*c,f=a.lng*c,g=b.lng*c,h=Math.sin(g-f)*Math.cos(e),i=Math.cos(d)*Math.sin(e)-Math.sin(d)*Math.cos(e)*Math.cos(g-f),j=(180*Math.atan2(h,i)/Math.PI+360)%360;return j>=180?j-360:j},destination:function(b,c,d){c=(c+360)%360;var e=Math.PI/180,f=180/Math.PI,g=6378137,h=b.lng*e,i=b.lat*e,j=c*e,k=Math.sin(i),l=Math.cos(i),m=Math.cos(d/g),n=Math.sin(d/g),o=Math.asin(k*m+l*n*Math.cos(j)),p=h+Math.atan2(Math.sin(j)*n*l,m-k*Math.sin(o));return p*=f,p=p>180?p-360:p<-180?p+360:p,a.latLng([o*f,p])}}),a.GeometryUtil});